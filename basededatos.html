<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mundo de Fe CR Â· Base de Datos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
    <style>
      :root {
        --azul: #0b1e4d;
        --gris-claro: #f5f6fa;
        --blanco: #fff;
      }

      body {
        font-family: "Poppins", sans-serif;
        background: var(--gris-claro);
        margin: 0;
        padding: 0;
      }

      header {
        background: var(--azul);
        color: white;
        text-align: center;
        padding: 20px 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      header h1 {
        margin: 0;
        font-size: 1.7rem;
      }

      main {
        padding: 20px;
        max-width: 700px;
        margin: 0 auto;
      }

      .card {
        background: var(--blanco);
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
        overflow: hidden;
        transition: 0.2s ease;
      }

      .card:hover {
        transform: scale(1.01);
      }

      .card-header {
        background: var(--azul);
        color: white;
        padding: 15px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .card-header h3 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 500;
      }

      .arrow {
        transition: transform 0.2s;
      }

      .card-content {
        display: none;
        padding: 15px;
        background: #f9f9ff;
      }

      .card-content p {
        margin: 6px 0;
      }

      .btn-group {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 10px;
      }

      button {
        border: none;
        padding: 6px 12px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        cursor: pointer;
        transition: 0.2s;
      }

      button:hover {
        transform: scale(1.05);
      }

      .edit {
        background: #007bff;
      }

      .save {
        background: #198754;
      }

      .delete {
        background: #dc3545;
      }

      footer {
        text-align: center;
        color: #777;
        padding: 20px 0;
        font-size: 0.9rem;
      }

      @media (max-width: 600px) {
        main {
          padding: 10px;
        }
      }
      .card.editing {
  box-shadow: 0 0 0 3px #007bff66; /* resalta con azul translÃºcido */
  background: #eef4ff; /* fondo sutil */
  transition: box-shadow 0.2s ease, background 0.3s ease;
}
@media (max-width: 600px) {
  .card.editing {
    background: #dce8ff; /* azul un poco mÃ¡s notorio en pantallas pequeÃ±as */
    box-shadow: 0 0 0 2px #0b1e4d88;
  }
}
      .card-content input {
  border: 2px solid #0b1e4d55;
  border-radius: 6px;
  padding: 6px 10px;
  font-family: "Poppins", sans-serif;
  outline: none;
  background: #f8faff;
  transition: 0.2s ease;
}
.card-content input:focus {
  border-color: #0b1e4d;
  background: #ffffff;
}

      @media (max-width: 600px) {
  .card-content input {
    width: 100%;
    padding: 10px 12px;
    font-size: 1rem;
    border-radius: 8px;
  }
}
      .acompanantes-block {
  margin-top: 10px;
  background: #f8faff;
  padding: 10px;
  border-radius: 8px;
}

.acompanantes-list {
  margin: 6px 0 0 10px;
  padding-left: 15px;
  color: #333;
}

.acompanantes-list li {
  margin-bottom: 4px;
}

      @media (max-width: 600px) {
  .acompanantes-block {
    padding: 8px;
    margin-top: 8px;
    background: #eef2ff; /* un poco mÃ¡s claro en mÃ³vil */
  }

  .acompanantes-block p {
    font-size: 0.95rem;
    margin-bottom: 6px;
  }

  .acompanantes-list {
    padding-left: 18px;
  }

  .acompanantes-list li {
    font-size: 0.9rem;
    line-height: 1.4;
    margin-bottom: 3px;
  }
}



    </style>
  </head>

  <body>
    <header>
      <h1>ðŸ“‹ Registro de Visitantes</h1>
      <p style="opacity: 0.9">Mundo de Fe Costa Rica</p>
    </header>

    <main id="contenedor"></main>

    <footer>
      Â© <span id="year"></span> Mundo de Fe Costa Rica Â· Todos los derechos reservados
    </footer>

    <script>
      document.getElementById("year").textContent = new Date().getFullYear();
    </script>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
      // ðŸ”¥ ConfiguraciÃ³n Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyCH3PFA3aZRfcWULt7zTTpNFERnKgijE7w",
        authDomain: "hospitalidad-mdf.firebaseapp.com",
        databaseURL: "https://hospitalidad-mdf-default-rtdb.firebaseio.com/",
        projectId: "hospitalidad-mdf",
        storageBucket: "hospitalidad-mdf.firebasestorage.app",
        messagingSenderId: "460182229194",
        appId: "1:460182229194:web:0dae840c04f5b5a7236433",
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      const contenedor = document.getElementById("contenedor");

      function cargarDatos() {
        db.ref("visitantes").on("value", (snapshot) => {
          contenedor.innerHTML = "";
          snapshot.forEach((child) => {
            const data = child.val();
            const id = child.key;

            const card = document.createElement("div");
            card.classList.add("card");

            // ConstrucciÃ³n de la tarjeta
            card.innerHTML = `
              <div class="card-header">
                <h3>${data.nombre || "Sin nombre"}</h3>
                <span class="arrow">â–¼</span>
              </div>
              <div class="card-content">
                <p><strong>Correo:</strong> ${data.correo || "No proporcionado"}</p>
                <p><strong>TelÃ©fono:</strong> ${data.telefono || "No proporcionado"}</p>
                <p><strong>Fecha:</strong> ${new Date(data.fecha).toLocaleString("es-CR")}</p>

                ${
                  data.acompanantes && data.acompanantes.length
                ? `
                  <div class="acompanantes-block">
                  <p><strong>AcompaÃ±antes:</strong></p>
                  <ul class="acompanantes-list">
                ${data.acompanantes
                  .map(a => `<li>${a.nombre} â€” <em>${a.relacion}</em></li>`)
                  .join("")}
              </ul>
            </div>
          `
        : ""
    }

    <div class="btn-group">
      <button class="edit">Editar</button>
      <button class="save" style="display:none;">Guardar</button>
      <button class="delete">Borrar</button>
    </div>
  </div>
`;


            // ðŸ”½ toggle desplegable
            const header = card.querySelector(".card-header");
            const content = card.querySelector(".card-content");
            const arrow = card.querySelector(".arrow");

            header.onclick = () => {
              const visible = content.style.display === "block";
              document.querySelectorAll(".card-content").forEach((c) => (c.style.display = "none"));
              document.querySelectorAll(".arrow").forEach((a) => (a.style.transform = "rotate(0deg)"));
              if (!visible) {
                content.style.display = "block";
                arrow.style.transform = "rotate(180deg)";
              }
            };

            // âœï¸ Editar
            const btnEdit = card.querySelector(".edit");
            const btnSave = card.querySelector(".save");
            const correoP = card.querySelector("p:nth-child(1)");
            const telP = card.querySelector("p:nth-child(2)");

            btnEdit.onclick = () => {
              card.classList.add("editing");
              correoP.innerHTML = `<strong>Correo:</strong> <input type="text" value="${data.correo || ""}" />`;
              telP.innerHTML = `<strong>TelÃ©fono:</strong> <input type="text" value="${data.telefono || ""}" />`;
              btnEdit.style.display = "none";
              btnSave.style.display = "inline-block";
            };

            // ðŸ’¾ Guardar
            btnSave.onclick = () => {
              const nuevoCorreo = correoP.querySelector("input").value.trim();
              const nuevoTel = telP.querySelector("input").value.trim();

              db.ref("visitantes/" + id).update({
                correo: nuevoCorreo,
                telefono: nuevoTel,
              });

              btnEdit.style.display = "inline-block";
              btnSave.style.display = "none";
              correoP.innerHTML = `<strong>Correo:</strong> ${nuevoCorreo || "No proporcionado"}`;
              telP.innerHTML = `<strong>TelÃ©fono:</strong> ${nuevoTel || "No proporcionado"}`;
              card.classList.remove("editing");
            };

            // ðŸ—‘ï¸ Borrar
            const btnDelete = card.querySelector(".delete");
            btnDelete.onclick = () => {
              if (confirm("Â¿Seguro que deseas eliminar este registro?")) {
                db.ref("visitantes/" + id).remove();
              }
            };

            contenedor.appendChild(card);
          });
        });
      }

      cargarDatos();
    </script>
  </body>
</html>
